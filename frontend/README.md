# Donatemates Frontend

We use [React](https://facebook.github.io/react/) and [Webpack](https://webpack.github.io/) to render, pre-compile, and minify our assets before serving them.

## Setup
To begin, you'll need to install the npm modules, and either globally or locally install webpack.

I recommend globally installing webpack with

```shell
npm i -G webpack
```

so that you can use it everywhere with the command `webpack`, but some people prefer it to be locally namespaced:

```shell
npm i webpack
```

Then you'll need to run it using:

```shell
./node_modules/webpack/bin/webpack.js
```

To install the remaining dependencies, simply run

```shell
npm i
```

from the `frontend/` directory.

## Making Changes to the Website

### Turn on the Dev Server
You have a few options for how to run a local dev server:

#### 1. `SimpleHTTPServer`
Use Python's built-in server to run your site at `http://localhost:8000`. This has the disadvantage of not routing non-root routes correctly, so to get around it, change all occurrences of `browserHistory` to `hashHistory` in `index.jsx`. (Don't forget to change them back before you push!)

To run, simply

```shell
python -m SimpleHTTPServer
```

or, in Python3,
```shell
python -m http.server
```

#### 2. `webpack-dev-server`
This one is a bit more finicky, but gives a better developer experience. Install with

```shell
npm i -G webpack-dev-server
```

and then run with

```shell
webpack-dev-server --content-base build/
```

### Editing and Live-Reloading

First, *make* the changes you want to see in the world. (A good place for this would be in `components/`, since aside from `index.jsx`, that's where all the action is.)

You should have your HTTP server (node or python, or another flavor if you prefer) already running. You can reload the `bundle.js` (generated by webpack) by passing the `--watch` flag to webpack:

```shell
#        debug    live-reload
webpack  -d       --watch
```

### My Setup
My usual setup is to have a Python server running in one terminal, serving from inside `dist/`:

```shell
cd dist
python2 -m SimpleHTTPServer
```

Then I open another pane and run the above webpack-watch command, which will automatically re-bundle `dist/static/bundle.js` whenever you make changes.

> **Note: You must refresh the page to see these changes take effect!**

## Updating a development stack
To push your frontend to your development stack, run

```shell
python donatemates.py update_frontend {stack}
```

where `{stack}` is the name of your stack.

## Caveats

### Images
Webpack intelligently encodes small images to base64 and includes them in the bundle: This saves round-trip overhead when requesting images, and is pretty awesome.

If your images use the `url()` CSS syntax but point to a large image that cannot be base64-encoded, you'll need to manually move it into the `dist/static` folder.

### `bundle.js` is big and ugly
Don't open `bundle.js` in Atom or other memory-bloated editors, it'll crash and make your day worse.